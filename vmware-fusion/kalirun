#!/bin/sh

VMNAME="kali.vmwarevm"
HOSTNAME="kali"
USERNAME=""
VMPATH="/Users/Shared/kali"

KALIRUNNING=$(vmrun list)

echo $KALIRUNNING | grep -q $VMNAME
if [ ! "$?" = 0 ]; then
  
    printf "%s\n" "[*] Starting VM."
    vmrun -T fusion start $VMPATH/$VMNAME nogui >/dev/null 2<&1
    printf "%s\n" "[*] VM Started."
    printf "%s" "[*] Connecting.."

    STARTED=1
    while [ ! "$STARTED" = 0 ]; do
        sleep 1
        printf '.'
        nc -z -G 1 $HOSTNAME 22 >/dev/null 2<&1
        if [ "$?" = 0 ]; then
            STARTED=0
            printf "%s\n"
            ssh -q $USERNAME@$HOSTNAME
        fi
    done
else
    ssh $USERNAME@$HOSTNAME
fi
